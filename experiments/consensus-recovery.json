{
    "version": "1.0.0",
    "title": "Induce consensus failure and recovery by removing and then restoring a sufficient number of nodes",
    "description": "Kill f random nodes to cause the cluster to fall out of consensus, test to ensure the cluster is out of consensus, bring one node back, and re-test; expecting the cluster to be in consensus. Note that CHAOS_VALIDATOR_NODES must be an environment variable containing a string that is a valid JSON list of node aliases as defined in CHAOS_GENESIS_FILE.",
    "tags": [
        "service",
        "indy-node",
        "concensus"
    ],
    "configuration": {
        "seed": {
            "type": "env",
            "key": "CHAOS_SEED"
        },
        "genesis_file": {
            "type": "env",
            "key": "CHAOS_GENESIS_FILE"
        },
        "validator_nodes": {
            "type": "env",
            "key": "CHAOS_VALIDATOR_NODES"
        },
        "kill_count": {
            "type": "env",
            "key": "CHAOS_KILL_COUNT"
        },
        "up_count": {
            "type": "env",
            "key": "CHAOS_UP_COUNT"
        },
    },
    "steady-state-hypothesis": {
        "title": "Can write nym",
        "probes": [
            {
                "type": "probe",
                "name": "can-write-nym",
                "tolerance": true,
                "provider": {
                    "type": "python",
                    "module": "chaosindy.probes",
                    "func": "write_nym",
                    "arguments": {
                        "seed": "${seed}",
                        "genesis_file": "${genesis_file}"
                    }
                }
            }
        ]
    },
    "method": [
        {
            "type": "action",
            "name": "kill-random-nodes",
            "provider": {
                "type": "python",
                "module": "chaosindy.actions",
                "func": "kill_random_nodes",
                "arguments": {
                    "nodes": "${validator_nodes}",
                    "count": "${kill_count}",
                    "genesis_file": "${genesis_file}"
                }
            },
            "pauses": {
                "after": 10
            }
        },
        {
            "type": "probe",
            "name": "cannot-write-nym",
            "tolerance": false,
            "provider": {
                "type": "python",
                "module": "chaosindy.probes",
                "func": "write_nym",
                "arguments": {
                    "seed": "${seed}",
                    "genesis_file": "${genesis_file}"
                }
            }
        },
        {
            "type": "action",
            "name": "ensure-nodes-up",
            "provider": {
                "type": "python",
                "module": "chaosindy.actions",
                "func": "ensure_nodes_up",
                "arguments": {
                    "nodes": "${validator_nodes}",
                    "count": "${up_count}",
                    "genesis_file": "${genesis_file}"
                }
            },
            "pauses": {
                "after": 10
            }
        }
    ],
    "rollbacks": []
}
